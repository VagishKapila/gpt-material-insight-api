<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Daily Log Submission</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      max-width: 700px;
      margin: auto;
    }
    label {
      display: block;
      margin-top: 15px;
      font-weight: bold;
    }
    input[type="text"], textarea {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
    }
    input[type="file"] {
      margin-top: 5px;
    }
    .checkbox-container {
      margin-top: 20px;
    }
    .button-group {
      margin-top: 30px;
    }
    .button-group button {
      margin-right: 10px;
      padding: 10px 15px;
      font-weight: bold;
    }
  </style>
</head>
<body>

  <h2>üìù Submit Your Daily Log</h2>

  <form action="/generate_form" method="post" enctype="multipart/form-data">
    
    <label for="project_name">Project Name</label>
    <input type="text" id="project_name" name="project_name" required>

    <label for="crew_notes">Crew Notes</label>
    <textarea id="crew_notes" name="crew_notes" rows="3"></textarea>

    <label for="work_done">Work Done</label>
    <textarea id="work_done" name="work_done" rows="3"></textarea>

    <label for="safety_notes">Safety Notes</label>
    <textarea id="safety_notes" name="safety_notes" rows="2"></textarea>

    <label for="equipment_used">Equipment Used</label>
    <textarea id="equipment_used" name="equipment_used" rows="2"></textarea>

    <label for="weather">Weather</label>
    <input type="text" id="weather" name="weather" placeholder="e.g., Sunny, 72¬∞F">
    <button type="button" onclick="fetchWeather()">Get Weather</button>

    <label for="images">Upload Job Site Photos</label>
    <input type="file" id="images" name="photos" accept="image/*" multiple required>

    <label for="logo">Optional Logo Upload</label>
    <input type="file" id="logo" name="logo" accept="image/*">

    <label for="scope_file">Optional Scope of Work (PDF, DOC)</label>
    <input type="file" id="scope_file" name="scope_file" accept=".pdf,.doc,.docx">

    <div class="checkbox-container">
      <input type="checkbox" id="run_ai" name="run_ai" checked>
      <label for="run_ai" style="display:inline;">Include AI/AR Page 3 (default ON)</label>
    </div>

    <div class="button-group">
      <button type="submit">Generate PDF</button>
      <button type="button" onclick="clearForm()">Clear All</button>
    </div>

  </form>

  <script>
    const lastData = {{ last_data | tojson | safe }};

    window.onload = () => {
      if (lastData) {
        const fields = ['project_name', 'crew_notes', 'work_done', 'safety_notes', 'equipment_used'];
        fields.forEach(field => {
          if (lastData[field]) {
            const el = document.getElementById(field);
            if (el) el.value = lastData[field];
          }
        });
      }
    };

    function clearForm() {
      const inputs = document.querySelectorAll('input[type="text"], textarea');
      inputs.forEach(input => input.value = '');
      document.getElementById('run_ai').checked = true;
    }

    function fetchWeather() {
      const location = document.getElementById('project_name').value;
      if (!location) {
        alert("Enter a Project Name (location) first.");
        return;
      }
      fetch(`/get_weather?location=${location}`)
        .then(res => res.json())
        .then(data => {
          document.getElementById('weather').value = data.weather || "N/A";
        })
        .catch(err => {
          alert("Weather fetch failed.");
        });
    }
  </script>

</body>
</html>
