<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Daily Log Submission</title>
  <script>
    function fetchWeather(location) {
      if (location.length < 2) return;
      fetch(`/get_weather?location=${encodeURIComponent(location)}`)
        .then(response => response.json())
        .then(data => {
          if (data.weather) {
            document.getElementById('weather_display').textContent = data.weather;
            document.getElementById('weather').value = data.weather;
          } else {
            document.getElementById('weather_display').textContent = "Weather unavailable";
          }
        })
        .catch(() => {
          document.getElementById('weather_display').textContent = "Weather fetch error";
        });
    }
  </script>
</head>
<body>
  <h1>Daily Log Submission</h1>
  <form id="dailyForm" enctype="multipart/form-data" method="post" action="/generate_form">
    <label>Date: <input type="date" name="date" required></label><br>
    <label>Project Name: <input type="text" name="project_name" required></label><br>
    <label>Client Name: <input type="text" name="client_name"></label><br>
    <label>Project Location:
      <input type="text" id="location" name="location" oninput="fetchWeather(this.value)">
    </label><br>
    <label>General Contractor: <input type="text" name="general_contractor"></label><br>
    <label>Crew Notes: <textarea name="crew_notes"></textarea></label><br>
    <label>Work Done: <textarea name="work_done"></textarea></label><br>
    <label>Equipment Used: <textarea name="equipment_used"></textarea></label><br>
    <label>Safety Notes: <textarea name="safety_notes"></textarea></label><br>
    <label>Material Summary: <textarea name="material_summary"></textarea></label><br>
    <label>Hours Worked: <input type="text" name="hours_worked"></label><br>

    <label>Weather:
      <div id="weather_display">Waiting for location...</div>
      <input type="hidden" id="weather" name="weather">
    </label><br>

    <label>Upload Scope of Work (.pdf, .docx, .xlsx): 
      <input type="file" name="scope_file" accept=".pdf,.docx,.xlsx">
    </label><br>

    <label>Upload Photos: <input type="file" name="photos" multiple accept="image/*"></label><br>
    <label>Upload Logo: <input type="file" name="logo" accept="image/*"></label><br>

    <label><input type="checkbox" name="include_page_2"> Include Page 2 (AI/AR Analysis)</label><br>

    <button type="submit">Generate PDF</button>
  </form>
</body>
</html>
