<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Daily Log Form</title>
    <style>
        label { display: block; margin-top: 10px; font-weight: bold; }
        input, textarea, select { width: 100%; padding: 6px; margin-top: 5px; }
        #weather_display { margin-top: 5px; font-weight: bold; }
    </style>
    <script>
        let debounceTimer;

        function debounceFetchWeather() {
            clearTimeout(debounceTimer);
            debounceTimer = setTimeout(fetchWeather, 1000);
        }

        function fetchWeather() {
            const location = document.getElementById("location").value;
            if (location.trim() === "") return;

            fetch(`/get_weather?location=${encodeURIComponent(location)}`)
                .then(response => response.json())
                .then(data => {
                    if (data.weather) {
                        document.getElementById("weather_display").textContent = data.weather;
                        document.getElementById("weather").value = data.weather;
                    } else {
                        document.getElementById("weather_display").textContent = "Weather unavailable";
                    }
                });
        }
    </script>
</head>
<body>
    <h1>Daily Log Submission</h1>
    <form action="/submit" method="POST" enctype="multipart/form-data">
        <label>Date: <input type="date" name="date" required></label>
        <label>Project Name: <input type="text" name="project_name" required></label>
        <label>Client Name: <input type="text" name="client_name" required></label>
        <label>Job Number: <input type="text" name="job_number"></label>
        <label>Prepared By: <input type="text" name="prepared_by" required></label>

        <label>Project Location:
            <input type="text" id="location" name="location" required oninput="debounceFetchWeather()">
        </label>

        <label>GC or Subcontractor: <input type="text" name="gc_or_sub"></label>

        <label>Crew Notes: <textarea name="crew_notes"></textarea></label>
        <label>Work Done: <textarea name="work_done"></textarea></label>
        <label>Deliveries: <textarea name="deliveries"></textarea></label>
        <label>Inspections: <textarea name="inspections"></textarea></label>
        <label>Equipment Used: <textarea name="equipment_used"></textarea></label>
        <label>Safety Notes: <textarea name="safety_notes"></textarea></label>

        <label>Auto-Fetched Weather:</label>
        <div id="weather_display">Waiting for location...</div>
        <input type="hidden" id="weather" name="weather">
        <label>Override Weather (optional): <input type="text" name="weather_override"></label>

        <label>Additional Notes: <textarea name="notes"></textarea></label>

        <label>Upload Jobsite Photos (max 20): <input type="file" name="photos" multiple accept="image/*"></label>
        <label>Upload Company Logo: <input type="file" name="logo" accept="image/*"></label>

        <label>
            <input type="checkbox" name="include_page_2"> Include Page 2 (AI/AR Analysis)
        </label>

        <button type="submit">Generate PDF</button>
    </form>
</body>
</html>
